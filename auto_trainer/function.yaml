kind: job
metadata:
  name: auto-trainer
  tag: ''
  hash: 91b3ca659484bedcb60f5e31279ce9116c2f2ccc
  project: ''
  labels:
    author: yonish
  categories:
  - machine-learning
  - model-training
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  build:
    functionSourceCode: ZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIE9wdGlvbmFsLCBVbmlvbiwgVHVwbGUsIEFueQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKaW1wb3J0IGpzb24KaW1wb3J0IG1scnVuCmltcG9ydCBwYW5kYXMgYXMgcGQKZnJvbSBza2xlYXJuLm1vZGVsX3NlbGVjdGlvbiBpbXBvcnQgdHJhaW5fdGVzdF9zcGxpdAoKZnJvbSBtbHJ1bi5hcnRpZmFjdHMgaW1wb3J0IEFydGlmYWN0CmZyb20gbWxydW4uZnJhbWV3b3Jrcy5hdXRvX21scnVuIGltcG9ydCBBdXRvTUxSdW4KZnJvbSBtbHJ1biBpbXBvcnQgZmVhdHVyZV9zdG9yZSBhcyBmcwpmcm9tIG1scnVuLmFwaS5zY2hlbWFzIGltcG9ydCBPYmplY3RLaW5kCmZyb20gbWxydW4udXRpbHMuaGVscGVycyBpbXBvcnQgY3JlYXRlX2NsYXNzLCBjcmVhdGVfZnVuY3Rpb24KZnJvbSBtbHJ1bi5tb2RlbF9tb25pdG9yaW5nLmZlYXR1cmVzX2RyaWZ0X3RhYmxlIGltcG9ydCBGZWF0dXJlc0RyaWZ0VGFibGVQbG90CmZyb20gbWxydW4ubW9kZWxfbW9uaXRvcmluZy5tb2RlbF9tb25pdG9yaW5nX2JhdGNoIGltcG9ydCAoCiAgICBWaXJ0dWFsRHJpZnQsCiAgICBjYWxjdWxhdGVfaW5wdXRzX3N0YXRpc3RpY3MsCikKClBhdGhUeXBlID0gVW5pb25bc3RyLCBQYXRoXQoKCmNsYXNzIEtXQXJnc1ByZWZpeGVzOgogICAgTU9ERUxfQ0xBU1MgPSAiQ0xBU1NfIgogICAgRklUID0gIkZJVF8iCiAgICBUUkFJTiA9ICJUUkFJTl8iCiAgICBQUkVESUNUID0gIlBSRURJQ1RfIgoKCmRlZiBfbW9yZV90aGFuX29uZShhcmdfbGlzdDogTGlzdCkgLT4gYm9vbDoKICAgIHJldHVybiBsZW4oWzEgZm9yIGFyZyBpbiBhcmdfbGlzdCBpZiBhcmcgaXMgbm90IE5vbmVdKSA+IDEKCgpkZWYgX2dldF9zdWJfZGljdF9ieV9wcmVmaXgoc3JjOiBEaWN0LCBwcmVmaXhfa2V5OiBzdHIpIC0+IERpY3Rbc3RyLCBBbnldOgogICAgIiIiCiAgICBDb2xsZWN0IGFsbCB0aGUga2V5cyBmcm9tIHRoZSBnaXZlbiBkaWN0IHRoYXQgc3RhcnRzIHdpdGggdGhlIGdpdmVuIHByZWZpeCBhbmQgY3JlYXRlcyBhIG5ldyBkaWN0aW9uYXJ5IHdpdGggdGhlc2UKICAgIGtleXMuCgogICAgOnBhcmFtIHNyYzogICAgICAgICBUaGUgc291cmNlIGRpY3QgdG8gZXh0cmFjdCB0aGUgdmFsdWVzIGZyb20uCiAgICA6cGFyYW0gcHJlZml4X2tleTogIE9ubHkga2V5cyB3aXRoIHRoaXMgcHJlZml4IHdpbGwgYmUgcmV0dXJuZWQuIFRoZSBrZXlzIGluIHRoZSByZXN1bHQgZGljdCB3aWxsIGJlIHdpdGhvdXQgdGhpcwogICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXguCiAgICAiIiIKICAgIHJldHVybiB7CiAgICAgICAga2V5LnJlcGxhY2UocHJlZml4X2tleSwgIiIpOiB2YWwKICAgICAgICBmb3Iga2V5LCB2YWwgaW4gc3JjLml0ZW1zKCkKICAgICAgICBpZiBrZXkuc3RhcnRzd2l0aChwcmVmaXhfa2V5KQogICAgfQoKCmRlZiBfZ2V0X2RhdGFmcmFtZSgKICAgIGNvbnRleHQ6IG1scnVuLk1MQ2xpZW50Q3R4LAogICAgZGF0YXNldDogbWxydW4uRGF0YUl0ZW0sCiAgICBsYWJlbF9jb2x1bW5zOiBPcHRpb25hbFtVbmlvbltzdHIsIExpc3Rbc3RyXV1dID0gTm9uZSwKICAgIGRyb3BfY29sdW1uczogVW5pb25bc3RyLCBMaXN0W3N0cl0sIGludCwgTGlzdFtpbnRdXSA9IE5vbmUsCikgLT4gVHVwbGVbcGQuRGF0YUZyYW1lLCBPcHRpb25hbFtVbmlvbltzdHIsIExpc3Rbc3RyXV1dXToKICAgICIiIgogICAgR2V0dGluZyB0aGUgRGF0YUZyYW1lIG9mIHRoZSBkYXRhc2V0IGFuZCBkcm9wIHRoZSBjb2x1bW5zIGFjY29yZGluZ2x5LgoKICAgIDpwYXJhbSBjb250ZXh0OiAgICAgICAgIE1MUnVuIGNvbnRleHQuCiAgICA6cGFyYW0gZGF0YXNldDogICAgICAgICBUaGUgZGF0YXNldCB0byB0cmFpbiB0aGUgbW9kZWwgb24uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW4gYmUgZWl0aGVyIGEgbGlzdCBvZiBsaXN0cywgZGljdCwgVVJJIG9yIGEgRmVhdHVyZVZlY3Rvci4KICAgIDpwYXJhbSBsYWJlbF9jb2x1bW5zOiAgIFRoZSB0YXJnZXQgbGFiZWwocykgb2YgdGhlIGNvbHVtbihzKSBpbiB0aGUgZGF0YXNldC4gZm9yIFJlZ3Jlc3Npb24gb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzaWZpY2F0aW9uIHRhc2tzLgogICAgOnBhcmFtIGRyb3BfY29sdW1uczogICAgc3RyL2ludCBvciBhIGxpc3Qgb2Ygc3RyaW5ncy9pbnRzIHRoYXQgcmVwcmVzZW50IHRoZSBjb2x1bW4gbmFtZXMvaW5kaWNlcyB0byBkcm9wLgogICAgIiIiCiAgICBpZiBpc2luc3RhbmNlKGRhdGFzZXQsIChsaXN0LCBkaWN0KSk6CiAgICAgICAgZGF0YXNldCA9IHBkLkRhdGFGcmFtZShkYXRhc2V0KQogICAgICAgICMgQ2hlY2tpbmcgaWYgZHJvcF9jb2x1bW5zIHByb3ZpZGVkIGJ5IGludGVnZXIgdHlwZToKICAgICAgICBpZiBkcm9wX2NvbHVtbnM6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2UoZHJvcF9jb2x1bW5zLCBzdHIpIG9yICgKICAgICAgICAgICAgICAgIGlzaW5zdGFuY2UoZHJvcF9jb2x1bW5zLCBsaXN0KQogICAgICAgICAgICAgICAgYW5kIGFueShpc2luc3RhbmNlKGNvbCwgc3RyKSBmb3IgY29sIGluIGRyb3BfY29sdW1ucykKICAgICAgICAgICAgKToKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKAogICAgICAgICAgICAgICAgICAgICJkcm9wX2NvbHVtbnMgbXVzdCBiZSBhbiBpbnRlZ2VyL2xpc3Qgb2YgaW50ZWdlcnMgaWYgbm90IHByb3ZpZGVkIHdpdGggYSBVUkkvRmVhdHVyZVZlY3RvciBkYXRhc2V0IgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcgogICAgICAgICAgICBkYXRhc2V0LmRyb3AoZHJvcF9jb2x1bW5zLCBheGlzPTEsIGlucGxhY2U9VHJ1ZSkKCiAgICAgICAgcmV0dXJuIGRhdGFzZXQsIGxhYmVsX2NvbHVtbnMKCiAgICBpZiBkYXRhc2V0Lm1ldGEgYW5kIGRhdGFzZXQubWV0YS5raW5kID09IE9iamVjdEtpbmQuZmVhdHVyZV92ZWN0b3I6CiAgICAgICAgIyBmZWF0dXJlLXZlY3RvciBjYXNlOgogICAgICAgIGxhYmVsX2NvbHVtbnMgPSBsYWJlbF9jb2x1bW5zIG9yIGRhdGFzZXQubWV0YS5zdGF0dXMubGFiZWxfY29sdW1uCiAgICAgICAgZGF0YXNldCA9IGZzLmdldF9vZmZsaW5lX2ZlYXR1cmVzKAogICAgICAgICAgICBkYXRhc2V0Lm1ldGEudXJpLCBkcm9wX2NvbHVtbnM9ZHJvcF9jb2x1bW5zCiAgICAgICAgKS50b19kYXRhZnJhbWUoKQoKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYibGFiZWwgY29sdW1uczoge2xhYmVsX2NvbHVtbnN9IikKICAgIGVsc2U6CiAgICAgICAgIyBzaW1wbGUgVVJMIGNhc2U6CiAgICAgICAgZGF0YXNldCA9IGRhdGFzZXQuYXNfZGYoKQogICAgICAgIGlmIGRyb3BfY29sdW1uczoKICAgICAgICAgICAgaWYgYWxsKGNvbCBpbiBkYXRhc2V0IGZvciBjb2wgaW4gZHJvcF9jb2x1bW5zKToKICAgICAgICAgICAgICAgIGRhdGFzZXQgPSBkYXRhc2V0LmRyb3AoZHJvcF9jb2x1bW5zLCBheGlzPTEpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgICAgICJub3QgYWxsIG9mIHRoZSBjb2x1bW5zIHRvIGRyb3AgaW4gdGhlIGRhdGFzZXQsIGRyb3AgY29sdW1ucyBwcm9jZXNzIHNraXBwZWQiCiAgICAgICAgICAgICAgICApCiAgICByZXR1cm4gZGF0YXNldCwgbGFiZWxfY29sdW1ucwoKCmRlZiB0cmFpbigKICAgIGNvbnRleHQ6IG1scnVuLk1MQ2xpZW50Q3R4LAogICAgZGF0YXNldDogbWxydW4uRGF0YUl0ZW0sCiAgICBkcm9wX2NvbHVtbnM6IExpc3Rbc3RyXSA9IE5vbmUsCiAgICBtb2RlbF9jbGFzczogc3RyID0gTm9uZSwKICAgIG1vZGVsX25hbWU6IHN0ciA9ICJtb2RlbCIsCiAgICB0YWc6IHN0ciA9ICIiLAogICAgbGFiZWxfY29sdW1uczogT3B0aW9uYWxbVW5pb25bc3RyLCBMaXN0W3N0cl1dXSA9IE5vbmUsCiAgICBzYW1wbGVfc2V0OiBtbHJ1bi5EYXRhSXRlbSA9IE5vbmUsCiAgICB0ZXN0X3NldDogbWxydW4uRGF0YUl0ZW0gPSBOb25lLAogICAgdHJhaW5fdGVzdF9zcGxpdF9zaXplOiBmbG9hdCA9IE5vbmUsCiAgICByYW5kb21fc3RhdGU6IGludCA9IE5vbmUsCik6CiAgICAiIiIKICAgIFRyYWluaW5nIHRoZSBnaXZlbiBtb2RlbCBvbiB0aGUgZ2l2ZW4gZGF0YXNldC4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICAgIE1MUnVuIGNvbnRleHQKICAgIDpwYXJhbSBkYXRhc2V0OiAgICAgICAgICAgICAgICAgVGhlIGRhdGFzZXQgdG8gdHJhaW4gdGhlIG1vZGVsIG9uLiBDYW4gYmUgZWl0aGVyIGEgVVJJIG9yIGEgRmVhdHVyZVZlY3RvcgogICAgOnBhcmFtIGRyb3BfY29sdW1uczogICAgICAgICAgICBzdHIgb3IgYSBsaXN0IG9mIHN0cmluZ3MgdGhhdCByZXByZXNlbnQgdGhlIGNvbHVtbnMgdG8gZHJvcAogICAgOnBhcmFtIG1vZGVsX2NsYXNzOiAgICAgICAgICAgICBUaGUgY2xhc3Mgb2YgdGhlIG1vZGVsLCBlLmcuIGBza2xlYXJuLmxpbmVhcl9tb2RlbC5Mb2dpc3RpY1JlZ3Jlc3Npb25gCiAgICA6cGFyYW0gbW9kZWxfbmFtZTogICAgICAgICAgICAgIFRoZSBtb2RlbCdzIG5hbWUgdG8gdXNlIGZvciBzdG9yaW5nIHRoZSBtb2RlbCBhcnRpZmFjdCwgZGVmYXVsdCB0byAnbW9kZWwnCiAgICA6cGFyYW0gdGFnOiAgICAgICAgICAgICAgICAgICAgIFRoZSBtb2RlbCdzIHRhZyB0byBsb2cgd2l0aAogICAgOnBhcmFtIGxhYmVsX2NvbHVtbnM6ICAgICAgICAgICBUaGUgdGFyZ2V0IGxhYmVsKHMpIG9mIHRoZSBjb2x1bW4ocykgaW4gdGhlIGRhdGFzZXQuIGZvciBSZWdyZXNzaW9uIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzaWZpY2F0aW9uIHRhc2tzCiAgICA6cGFyYW0gc2FtcGxlX3NldDogICAgICAgICAgICAgIEEgc2FtcGxlIHNldCBvZiBpbnB1dHMgZm9yIHRoZSBtb2RlbCBmb3IgbG9nZ2luZyBpdHMgc3RhdHMgYWxvbmcgdGhlIG1vZGVsIGluIGZhdm91cgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZiBtb2RlbCBtb25pdG9yaW5nLiBDYW4gYmUgZWl0aGVyIGEgVVJJIG9yIGEgRmVhdHVyZVZlY3RvcgogICAgOnBhcmFtIHRlc3Rfc2V0OiAgICAgICAgICAgICAgICBUaGUgdGVzdCBzZXQgdG8gdHJhaW4gdGhlIG1vZGVsIHdpdGgKICAgIDpwYXJhbSB0cmFpbl90ZXN0X3NwbGl0X3NpemU6ICAgU2hvdWxkIGJlIGJldHdlZW4gMC4wIGFuZCAxLjAgYW5kIHJlcHJlc2VudCB0aGUgcHJvcG9ydGlvbiBvZiB0aGUgZGF0YXNldCB0byBpbmNsdWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIHRoZSB0ZXN0IHNwbGl0LiBUaGUgc2l6ZSBvZiB0aGUgVHJhaW5pbmcgc2V0IGlzIHNldCB0byB0aGUgY29tcGxlbWVudCBvZiB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLiBEZWZhdWx0ID0gMC4yCiAgICA6cGFyYW0gcmFuZG9tX3N0YXRlOiAgICAgICAgICAgIFJhbmRvbSBzdGF0ZSBmb3IgYHRyYWluX3Rlc3Rfc3BsaXRgCiAgICAiIiIKICAgICMgVmFsaWRhdGUgaW5wdXRzOgogICAgIyBDaGVjayBpZiBleGFjdGx5IG9uZSBvZiB0aGVtIGlzIHN1cHBsaWVkOgogICAgaWYgdGVzdF9zZXQgaXMgTm9uZToKICAgICAgICBpZiB0cmFpbl90ZXN0X3NwbGl0X3NpemUgaXMgTm9uZToKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbygKICAgICAgICAgICAgICAgICJ0ZXN0X3NldCBvciB0cmFpbl90ZXN0X3NwbGl0X3NpemUgYXJlIG5vdCBwcm92aWRlZCwgc2V0dGluZyB0cmFpbl90ZXN0X3NwbGl0X3NpemUgdG8gMC4yIgogICAgICAgICAgICApCiAgICAgICAgICAgIHRyYWluX3Rlc3Rfc3BsaXRfc2l6ZSA9IDAuMgoKICAgIGVsaWYgdHJhaW5fdGVzdF9zcGxpdF9zaXplOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oCiAgICAgICAgICAgICJ0ZXN0X3NldCBwcm92aWRlZCwgaWdub3JpbmcgZ2l2ZW4gdHJhaW5fdGVzdF9zcGxpdF9zaXplIHZhbHVlIgogICAgICAgICkKICAgICAgICB0cmFpbl90ZXN0X3NwbGl0X3NpemUgPSBOb25lCgogICAgIyBHZXQgRGF0YUZyYW1lIGJ5IFVSTCBvciBieSBGZWF0dXJlVmVjdG9yOgogICAgZGF0YXNldCwgbGFiZWxfY29sdW1ucyA9IF9nZXRfZGF0YWZyYW1lKAogICAgICAgIGNvbnRleHQ9Y29udGV4dCwKICAgICAgICBkYXRhc2V0PWRhdGFzZXQsCiAgICAgICAgbGFiZWxfY29sdW1ucz1sYWJlbF9jb2x1bW5zLAogICAgICAgIGRyb3BfY29sdW1ucz1kcm9wX2NvbHVtbnMsCiAgICApCgogICAgIyBHZXR0aW5nIHRoZSBzYW1wbGUgc2V0OgogICAgaWYgc2FtcGxlX3NldCBpcyBOb25lOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oCiAgICAgICAgICAgIGYiU2FtcGxlIHNldCBub3QgZ2l2ZW4sIHVzaW5nIHRoZSB3aG9sZSB0cmFpbmluZyBzZXQgYXMgdGhlIHNhbXBsZSBzZXQiCiAgICAgICAgKQogICAgICAgIHNhbXBsZV9zZXQgPSBkYXRhc2V0CiAgICBlbHNlOgogICAgICAgIHNhbXBsZV9zZXQsIF8gPSBfZ2V0X2RhdGFmcmFtZSgKICAgICAgICAgICAgY29udGV4dD1jb250ZXh0LAogICAgICAgICAgICBkYXRhc2V0PXNhbXBsZV9zZXQsCiAgICAgICAgICAgIGxhYmVsX2NvbHVtbnM9bGFiZWxfY29sdW1ucywKICAgICAgICAgICAgZHJvcF9jb2x1bW5zPWRyb3BfY29sdW1ucywKICAgICAgICApCgogICAgIyBQYXJzaW5nIGt3YXJnczoKICAgICMgVE9ETzogVXNlIGluIHhnYiBvciBsZ2JtIHRyYWluIGZ1bmN0aW9uLgogICAgdHJhaW5fa3dhcmdzID0gX2dldF9zdWJfZGljdF9ieV9wcmVmaXgoCiAgICAgICAgc3JjPWNvbnRleHQucGFyYW1ldGVycywgcHJlZml4X2tleT1LV0FyZ3NQcmVmaXhlcy5UUkFJTgogICAgKQogICAgZml0X2t3YXJncyA9IF9nZXRfc3ViX2RpY3RfYnlfcHJlZml4KAogICAgICAgIHNyYz1jb250ZXh0LnBhcmFtZXRlcnMsIHByZWZpeF9rZXk9S1dBcmdzUHJlZml4ZXMuRklUCiAgICApCiAgICBtb2RlbF9jbGFzc19rd2FyZ3MgPSBfZ2V0X3N1Yl9kaWN0X2J5X3ByZWZpeCgKICAgICAgICBzcmM9Y29udGV4dC5wYXJhbWV0ZXJzLCBwcmVmaXhfa2V5PUtXQXJnc1ByZWZpeGVzLk1PREVMX0NMQVNTCiAgICApCgogICAgIyBDaGVjayBpZiBtb2RlbCBvciBmdW5jdGlvbjoKICAgIGlmIGhhc2F0dHIobW9kZWxfY2xhc3MsICJ0cmFpbiIpOgogICAgICAgICMgVE9ETzogTmVlZCB0byBjYWxsOiBtb2RlbCgpLCBhZnRlcndhcmRzIHRvIHN0YXJ0IHRoZSB0cmFpbiBmdW5jdGlvbi4KICAgICAgICAjIG1vZGVsID0gY3JlYXRlX2Z1bmN0aW9uKGYie21vZGVsX2NsYXNzfS50cmFpbiIpCiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcgogICAgZWxzZToKICAgICAgICAjIENyZWF0aW5nIG1vZGVsIGluc3RhbmNlOgogICAgICAgIG1vZGVsID0gY3JlYXRlX2NsYXNzKG1vZGVsX2NsYXNzKSgqKm1vZGVsX2NsYXNzX2t3YXJncykKCiAgICB4ID0gZGF0YXNldC5kcm9wKGxhYmVsX2NvbHVtbnMsIGF4aXM9MSkKICAgIHkgPSBkYXRhc2V0W2xhYmVsX2NvbHVtbnNdCiAgICBpZiB0cmFpbl90ZXN0X3NwbGl0X3NpemU6CiAgICAgICAgeF90cmFpbiwgeF90ZXN0LCB5X3RyYWluLCB5X3Rlc3QgPSB0cmFpbl90ZXN0X3NwbGl0KAogICAgICAgICAgICB4LCB5LCB0ZXN0X3NpemU9dHJhaW5fdGVzdF9zcGxpdF9zaXplLCByYW5kb21fc3RhdGU9cmFuZG9tX3N0YXRlCiAgICAgICAgKQogICAgZWxzZToKICAgICAgICB4X3RyYWluLCB5X3RyYWluID0geCwgeQoKICAgICAgICB0ZXN0X3NldCA9IHRlc3Rfc2V0LmFzX2RmKCkKICAgICAgICBpZiBkcm9wX2NvbHVtbnM6CiAgICAgICAgICAgIHRlc3Rfc2V0ID0gZGF0YXNldC5kcm9wKGRyb3BfY29sdW1ucywgYXhpcz0xKQoKICAgICAgICB4X3Rlc3QsIHlfdGVzdCA9IHRlc3Rfc2V0LmRyb3AobGFiZWxfY29sdW1ucywgYXhpcz0xKSwgdGVzdF9zZXRbbGFiZWxfY29sdW1uc10KCiAgICBBdXRvTUxSdW4uYXBwbHlfbWxydW4oCiAgICAgICAgbW9kZWw9bW9kZWwsCiAgICAgICAgbW9kZWxfbmFtZT1tb2RlbF9uYW1lLAogICAgICAgIGNvbnRleHQ9Y29udGV4dCwKICAgICAgICB0YWc9dGFnLAogICAgICAgIHNhbXBsZV9zZXQ9c2FtcGxlX3NldCwKICAgICAgICB5X2NvbHVtbnM9bGFiZWxfY29sdW1ucywKICAgICAgICB0ZXN0X3NldD10ZXN0X3NldCwKICAgICAgICB4X3Rlc3Q9eF90ZXN0LAogICAgICAgIHlfdGVzdD15X3Rlc3QsCiAgICApCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYidHJhaW5pbmcgJ3ttb2RlbF9uYW1lfSciKQogICAgbW9kZWwuZml0KHhfdHJhaW4sIHlfdHJhaW4sICoqZml0X2t3YXJncykKCgpkZWYgZXZhbHVhdGUoCiAgICBjb250ZXh0OiBtbHJ1bi5NTENsaWVudEN0eCwKICAgIG1vZGVsOiBzdHIsCiAgICBkYXRhc2V0OiBtbHJ1bi5EYXRhSXRlbSwKICAgIGRyb3BfY29sdW1uczogTGlzdFtzdHJdID0gTm9uZSwKICAgIGxhYmVsX2NvbHVtbnM6IE9wdGlvbmFsW1VuaW9uW3N0ciwgTGlzdFtzdHJdXV0gPSBOb25lLAopOgogICAgIiIiCiAgICBFdmFsdWF0aW5nIGEgbW9kZWwuIEFydGlmYWN0cyBnZW5lcmF0ZWQgYnkgdGhlIE1MSGFuZGxlci4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICAgIE1MUnVuIGNvbnRleHQuCiAgICA6cGFyYW0gbW9kZWw6ICAgICAgICAgICAgICAgICAgIFRoZSBtb2RlbCBTdG9yZSBwYXRoLgogICAgOnBhcmFtIGRhdGFzZXQ6ICAgICAgICAgICAgICAgICBUaGUgZGF0YXNldCB0byBldmFsdWF0ZSB0aGUgbW9kZWwgb24uIENhbiBiZSBlaXRoZXIgYSBVUkkgb3IgYSBGZWF0dXJlVmVjdG9yLgogICAgOnBhcmFtIGRyb3BfY29sdW1uczogICAgICAgICAgICBzdHIgb3IgYSBsaXN0IG9mIHN0cmluZ3MgdGhhdCByZXByZXNlbnQgdGhlIGNvbHVtbnMgdG8gZHJvcC4KICAgIDpwYXJhbSBsYWJlbF9jb2x1bW5zOiAgICAgICAgICAgVGhlIHRhcmdldCBsYWJlbChzKSBvZiB0aGUgY29sdW1uKHMpIGluIHRoZSBkYXRhc2V0LiBmb3IgUmVncmVzc2lvbiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDbGFzc2lmaWNhdGlvbiB0YXNrcy4KICAgICIiIgogICAgIyBHZXQgZGF0YXNldCBieSBVUkwgb3IgYnkgRmVhdHVyZVZlY3RvcjoKICAgIGRhdGFzZXQsIGxhYmVsX2NvbHVtbnMgPSBfZ2V0X2RhdGFmcmFtZSgKICAgICAgICBjb250ZXh0PWNvbnRleHQsCiAgICAgICAgZGF0YXNldD1kYXRhc2V0LAogICAgICAgIGxhYmVsX2NvbHVtbnM9bGFiZWxfY29sdW1ucywKICAgICAgICBkcm9wX2NvbHVtbnM9ZHJvcF9jb2x1bW5zLAogICAgKQoKICAgICMgUGFyc2luZyBsYWJlbF9jb2x1bW5zOgogICAgcGFyc2VkX2xhYmVsX2NvbHVtbnMgPSBbXQogICAgaWYgbGFiZWxfY29sdW1uczoKICAgICAgICBsYWJlbF9jb2x1bW5zID0gKAogICAgICAgICAgICBsYWJlbF9jb2x1bW5zIGlmIGlzaW5zdGFuY2UobGFiZWxfY29sdW1ucywgbGlzdCkgZWxzZSBbbGFiZWxfY29sdW1uc10KICAgICAgICApCiAgICAgICAgZm9yIGxjIGluIGxhYmVsX2NvbHVtbnM6CiAgICAgICAgICAgIGlmIGZzLmNvbW1vbi5mZWF0dXJlX3NlcGFyYXRvciBpbiBsYzoKICAgICAgICAgICAgICAgIGZlYXR1cmVfc2V0X25hbWUsIGxhYmVsX25hbWUsIGFsaWFzID0gZnMuY29tbW9uLnBhcnNlX2ZlYXR1cmVfc3RyaW5nKGxjKQogICAgICAgICAgICAgICAgcGFyc2VkX2xhYmVsX2NvbHVtbnMuYXBwZW5kKGFsaWFzIG9yIGxhYmVsX25hbWUpCiAgICAgICAgaWYgcGFyc2VkX2xhYmVsX2NvbHVtbnM6CiAgICAgICAgICAgIGxhYmVsX2NvbHVtbnMgPSBwYXJzZWRfbGFiZWxfY29sdW1ucwoKICAgICMgUGFyc2luZyBrd2FyZ3M6CiAgICBwcmVkaWN0X2t3YXJncyA9IF9nZXRfc3ViX2RpY3RfYnlfcHJlZml4KAogICAgICAgIHNyYz1jb250ZXh0LnBhcmFtZXRlcnMsIHByZWZpeF9rZXk9S1dBcmdzUHJlZml4ZXMuUFJFRElDVAogICAgKQoKICAgIHggPSBkYXRhc2V0LmRyb3AobGFiZWxfY29sdW1ucywgYXhpcz0xKQogICAgeSA9IGRhdGFzZXRbbGFiZWxfY29sdW1uc10KCiAgICAjIExvYWRpbmcgdGhlIG1vZGVsIGFuZCBwcmVkaWN0aW5nOgogICAgbW9kZWxfaGFuZGxlciA9IEF1dG9NTFJ1bi5sb2FkX21vZGVsKG1vZGVsX3BhdGg9bW9kZWwsIGNvbnRleHQ9Y29udGV4dCkKICAgIEF1dG9NTFJ1bi5hcHBseV9tbHJ1bihtb2RlbF9oYW5kbGVyLm1vZGVsLCB5X3Rlc3Q9eSwgbW9kZWxfcGF0aD1tb2RlbCkKCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYiZXZhbHVhdGluZyAne21vZGVsX2hhbmRsZXIubW9kZWxfbmFtZX0nIikKICAgIG1vZGVsX2hhbmRsZXIubW9kZWwucHJlZGljdCh4LCAqKnByZWRpY3Rfa3dhcmdzKQoKCmRlZiBfcGVyZm9ybV9kcmlmdF9hbmFseXNpcygKICAgIGNvbnRleHQ6IG1scnVuLk1MQ2xpZW50Q3R4LAogICAgc2FtcGxlX3NldF9zdGF0aXN0aWNzOiBkaWN0LAogICAgaW5wdXRzOiBwZC5EYXRhRnJhbWUsCiAgICBkcmlmdF90aHJlc2hvbGQ6IGZsb2F0LAogICAgcG9zc2libGVfZHJpZnRfdGhyZXNob2xkOiBmbG9hdCwKKSAtPiBUdXBsZVtBcnRpZmFjdCwgQXJ0aWZhY3QsIEFydGlmYWN0XToKICAgICIiIgogICAgUGVyZm9ybSBkcmlmdCBhbmFseXNpcywgcHJvZHVjaW5nIHRoZSBkcmlmdCB0YWJsZSBhcnRpZmFjdCBmb3IgbG9nZ2luZyBwb3N0IHByZWRpY3Rpb24uCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICAgICAgICAgTUxSdW4gY29udGV4dC4KICAgIDpwYXJhbSBzYW1wbGVfc2V0X3N0YXRpc3RpY3M6ICAgIFRoZSBzdGF0aXN0aWNzIG9mIHRoZSBzYW1wbGUgc2V0IGxvZ2dlZCBhbG9uZyBhIG1vZGVsLgogICAgOnBhcmFtIGlucHV0czogICAgICAgICAgICAgICAgICAgSW5wdXQgZGF0YXNldCB0byBwZXJmb3JtIHRoZSBkcmlmdCBjYWxjdWxhdGlvbiBvbi4KICAgIDpwYXJhbSBkcmlmdF90aHJlc2hvbGQ6ICAgICAgICAgIFRoZSB0aHJlc2hvbGQgb2Ygd2hpY2ggdG8gbWFyayBkcmlmdHMuIERlZmF1bHRlZCB0byAwLjcuCiAgICA6cGFyYW0gcG9zc2libGVfZHJpZnRfdGhyZXNob2xkOiBUaGUgdGhyZXNob2xkIG9mIHdoaWNoIHRvIG1hcmsgcG9zc2libGUgZHJpZnRzLiBEZWZhdWx0ZWQgdG8gMC41LgoKICAgIDpyZXR1cm5zOiBBbiBNTFJ1biBhcnRpZmFjdCBob2xkaW5nIHRoZSBIVE1MIGNvZGUgb2YgdGhlIGRyaWZ0IHRhYmxlIHBsb3QuCiAgICAiIiIKICAgICMgQ2FsY3VsYXRlIHRoZSBpbnB1dHMgc3RhdGlzdGljczoKICAgIGlucHV0c19zdGF0aXN0aWNzID0gY2FsY3VsYXRlX2lucHV0c19zdGF0aXN0aWNzKAogICAgICAgIHNhbXBsZV9zZXRfc3RhdGlzdGljcz1zYW1wbGVfc2V0X3N0YXRpc3RpY3MsCiAgICAgICAgaW5wdXRzPWlucHV0cywKICAgICkKCiAgICAjIENhbGN1bGF0ZSBkcmlmdDoKICAgIHZpcnR1YWxfZHJpZnQgPSBWaXJ0dWFsRHJpZnQoaW5mX2NhcHBpbmc9MTApCiAgICBtZXRyaWNzID0gdmlydHVhbF9kcmlmdC5jb21wdXRlX2RyaWZ0X2Zyb21faGlzdG9ncmFtcygKICAgICAgICBmZWF0dXJlX3N0YXRzPXNhbXBsZV9zZXRfc3RhdGlzdGljcywKICAgICAgICBjdXJyZW50X3N0YXRzPWlucHV0c19zdGF0aXN0aWNzLAogICAgKQogICAgZHJpZnRfcmVzdWx0cyA9IHZpcnR1YWxfZHJpZnQuY2hlY2tfZm9yX2RyaWZ0X3Blcl9mZWF0dXJlKAogICAgICAgIG1ldHJpY3NfcmVzdWx0c19kaWN0aW9uYXJ5PW1ldHJpY3MsCiAgICAgICAgcG9zc2libGVfZHJpZnRfdGhyZXNob2xkPXBvc3NpYmxlX2RyaWZ0X3RocmVzaG9sZCwKICAgICAgICBkcmlmdF9kZXRlY3RlZF90aHJlc2hvbGQ9ZHJpZnRfdGhyZXNob2xkLAogICAgKQoKICAgICMgRGlzY292ZXIgY29tbW9uIGZlYXR1cmVzIChpbiBpZGVhbCBzY2VuYXJpbyB0aGlzIGNoZWNrIHNob3VsZCBub3Qgb2NjdXIsIGRhdGEgc2hvdWxkIGJlIHZhbGlkYXRlZCBiZWZvcmUgZ2V0dGluZwogICAgIyBpbnRvIHByZWRpY3Rpb24pOgogICAgc2FtcGxlX2ZlYXR1cmVzID0gc2V0KAogICAgICAgIFsKICAgICAgICAgICAgZmVhdHVyZV9uYW1lCiAgICAgICAgICAgIGZvciBmZWF0dXJlX25hbWUsIGZlYXR1cmVfc3RhdGlzdGljcyBpbiBzYW1wbGVfc2V0X3N0YXRpc3RpY3MuaXRlbXMoKQogICAgICAgICAgICBpZiBpc2luc3RhbmNlKGZlYXR1cmVfc3RhdGlzdGljcywgZGljdCkKICAgICAgICBdCiAgICApCiAgICBmZWF0dXJlcyA9IGlucHV0cy5jb2x1bW5zCiAgICBpZiBsZW4oc2FtcGxlX2ZlYXR1cmVzICYgc2V0KGZlYXR1cmVzKSkgPT0gMDoKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKAogICAgICAgICAgICAiTm8gbWF0Y2hpbmcgZmVhdHVyZXMgKGNvbHVtbiBuYW1lcykgcHJvdmlkZWQgIgogICAgICAgICAgICAiYmV0d2VlbiB0aGUgc2FtcGxlIHNldCBpbiB0aGUgbW9kZWwgYW5kIHRoZSBjdXJyZW50IGlucHV0cy4iCiAgICAgICAgKQogICAgZWxpZiBsZW4oc2FtcGxlX2ZlYXR1cmVzICYgc2V0KGZlYXR1cmVzKSkgIT0gbGVuKGZlYXR1cmVzKToKICAgICAgICBjb250ZXh0LmxvZ2dlci53YXJuKAogICAgICAgICAgICBmIk5vdCBhbGwgZmVhdHVyZSBuYW1lcyB3ZXJlIG1hdGNoaW5nIGJldHdlZW4gdGhlIGlucHV0cyBhbmQgdGhlIHNhbXBsZSBzZXQgaW4gdGhlIG1vZGVsLiAiCiAgICAgICAgICAgIGYiVGhlIGZvbGxvd2luZyBmZWF0dXJlcyB3b24ndCBiZSBpbmNsdWRlZCBpbiB0aGUgZHJpZnQgYW5hbHlzaXM6ICIKICAgICAgICAgICAgZiJ7c2V0KGZlYXR1cmVzKSAtIHNhbXBsZV9mZWF0dXJlcyB8IHNhbXBsZV9mZWF0dXJlcyAtIHNldChmZWF0dXJlcyl9IgogICAgICAgICkKICAgICAgICBmZWF0dXJlcyA9IGxpc3Qoc2FtcGxlX2ZlYXR1cmVzICYgc2V0KGZlYXR1cmVzKSkKCiAgICAjIFBsb3Q6CiAgICBodG1sX3Bsb3QgPSBGZWF0dXJlc0RyaWZ0VGFibGVQbG90KCkucHJvZHVjZSgKICAgICAgICBmZWF0dXJlcz1mZWF0dXJlcywKICAgICAgICBzYW1wbGVfc2V0X3N0YXRpc3RpY3M9c2FtcGxlX3NldF9zdGF0aXN0aWNzLAogICAgICAgIGlucHV0c19zdGF0aXN0aWNzPWlucHV0c19zdGF0aXN0aWNzLAogICAgICAgIG1ldHJpY3M9bWV0cmljcywKICAgICAgICBkcmlmdF9yZXN1bHRzPWRyaWZ0X3Jlc3VsdHMsCiAgICApCgogICAgcmV0dXJuICgKICAgICAgICBBcnRpZmFjdChib2R5PWh0bWxfcGxvdCwgZm9ybWF0PSJodG1sIiwga2V5PSJkcmlmdF90YWJsZV9wbG90IiksCiAgICAgICAgQXJ0aWZhY3QoYm9keT1qc29uLmR1bXBzKG1ldHJpY3MpLCBmb3JtYXQ9Impzb24iLCBrZXk9ImRyaWZ0X3Jlc3VsdHMiKSwKICAgICAgICBBcnRpZmFjdCgKICAgICAgICAgICAgYm9keT1qc29uLmR1bXBzKGlucHV0c19zdGF0aXN0aWNzKSwgZm9ybWF0PSJqc29uIiwga2V5PSJkYXRhc2V0X3N0YXRpc3RpY3MiCiAgICAgICAgKSwKICAgICkKCgpkZWYgcHJlZGljdCgKICAgIGNvbnRleHQ6IG1scnVuLk1MQ2xpZW50Q3R4LAogICAgbW9kZWw6IHN0ciwKICAgIGRhdGFzZXQ6IG1scnVuLkRhdGFJdGVtLAogICAgZHJvcF9jb2x1bW5zOiBVbmlvbltzdHIsIExpc3Rbc3RyXSwgaW50LCBMaXN0W2ludF1dID0gTm9uZSwKICAgIGxhYmVsX2NvbHVtbnM6IE9wdGlvbmFsW1VuaW9uW3N0ciwgTGlzdFtzdHJdXV0gPSBOb25lLAogICAgcGVyZm9ybV9kcmlmdF9hbmFseXNpczogYm9vbCA9IE5vbmUsCiAgICBkcmlmdF90aHJlc2hvbGQ6IGZsb2F0ID0gMC43LAogICAgcG9zc2libGVfZHJpZnRfdGhyZXNob2xkOiBmbG9hdCA9IDAuNSwKKToKICAgICIiIgogICAgUGVyZm9ybSBhIHByZWRpY3Rpb24gb24gYSBnaXZlbiBkYXRhc2V0IHdpdGggdGhlIGdpdmVuIG1vZGVsLiBDYW4gcGVyZm9ybSBkcmlmdCBhbmFseXNpcyBiZXR3ZWVuIHRoZSBzYW1wbGUgc2V0CiAgICBzdGF0aXN0aWNzIHN0b3JlZCBpbiB0aGUgbW9kZWwgdG8gdGhlIGN1cnJlbnQgaW5wdXQgZGF0YS4gVGhlIGRyaWZ0IHJ1bGUgaXMgdGhlIHZhbHVlIHBlci1mZWF0dXJlIG1lYW4gb2YgdGhlIFRWRAogICAgYW5kIEhlbGxpbmdlciBzY29yZXMgYWNjb3JkaW5nIHRvIHRoZSB0aHJlc2hvbGRzIGNvbmZpZ3VyZXMgaGVyZS4KCiAgICA6cGFyYW0gY29udGV4dDogICAgICAgICAgICAgICAgICBNTFJ1biBjb250ZXh0LgogICAgOnBhcmFtIG1vZGVsOiAgICAgICAgICAgICAgICAgICAgVGhlIG1vZGVsIFN0b3JlIHBhdGguCiAgICA6cGFyYW0gZGF0YXNldDogICAgICAgICAgICAgICAgICBUaGUgZGF0YXNldCB0byBldmFsdWF0ZSB0aGUgbW9kZWwgb24uIENhbiBiZSBlaXRoZXIgYSBVUkksIGEgRmVhdHVyZVZlY3RvciBvciBhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wbGUgaW4gYSBzaGFwZSBvZiBhIGxpc3QvZGljdC4KICAgIDpwYXJhbSBkcm9wX2NvbHVtbnM6ICAgICAgICAgICAgIHN0ci9pbnQgb3IgYSBsaXN0IG9mIHN0cmluZ3MvaW50cyB0aGF0IHJlcHJlc2VudCB0aGUgY29sdW1uIG5hbWVzL2luZGljZXMgdG8gZHJvcC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdoZW4gdGhlIGRhdGFzZXQgaXMgYSBsaXN0L2RpY3QgdGhpcyBwYXJhbWV0ZXIgc2hvdWxkIGJlIHJlcHJlc2VudGVkIGJ5IGludGVnZXJzLgogICAgOnBhcmFtIGxhYmVsX2NvbHVtbnM6ICAgICAgICAgICAgVGhlIHRhcmdldCBsYWJlbChzKSBvZiB0aGUgY29sdW1uKHMpIGluIHRoZSBkYXRhc2V0LiBmb3IgUmVncmVzc2lvbiBvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3NpZmljYXRpb24gdGFza3MuCiAgICA6cGFyYW0gcGVyZm9ybV9kcmlmdF9hbmFseXNpczogICBXaGV0aGVyIHRvIHBlcmZvcm0gZHJpZnQgYW5hbHlzaXMgYmV0d2VlbiB0aGUgc2FtcGxlIHNldCBvZiB0aGUgbW9kZWwgb2JqZWN0IHRvIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YXNldCBnaXZlbi4gQnkgZGVmYXVsdCwgTm9uZSwgd2hpY2ggbWVhbnMgaXQgd2lsbCBwZXJmb3JtIGRyaWZ0IGFuYWx5c2lzIGlmIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwgaGFzIGEgc2FtcGxlIHNldCBzdGF0aXN0aWNzLiBQZXJmb3JtIGRyaWZ0IGFuYWx5c2lzIHdpbGwgcHJvZHVjZSBhIGRhdGEgZHJpZnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlIGFydGlmYWN0LgogICAgOnBhcmFtIGRyaWZ0X3RocmVzaG9sZDogICAgICAgICAgVGhlIHRocmVzaG9sZCBvZiB3aGljaCB0byBtYXJrIGRyaWZ0cy4gRGVmYXVsdGVkIHRvIDAuNy4KICAgIDpwYXJhbSBwb3NzaWJsZV9kcmlmdF90aHJlc2hvbGQ6IFRoZSB0aHJlc2hvbGQgb2Ygd2hpY2ggdG8gbWFyayBwb3NzaWJsZSBkcmlmdHMuIERlZmF1bHRlZCB0byAwLjUuCiAgICAiIiIKICAgICMgR2V0IGRhdGFzZXQgYnkgVVJMIG9yIGJ5IEZlYXR1cmVWZWN0b3I6CiAgICBkYXRhc2V0LCBsYWJlbF9jb2x1bW5zID0gX2dldF9kYXRhZnJhbWUoCiAgICAgICAgY29udGV4dD1jb250ZXh0LAogICAgICAgIGRhdGFzZXQ9ZGF0YXNldCwKICAgICAgICBsYWJlbF9jb2x1bW5zPWxhYmVsX2NvbHVtbnMsCiAgICAgICAgZHJvcF9jb2x1bW5zPWRyb3BfY29sdW1ucywKICAgICkKCiAgICAjIFBhcnNpbmcga3dhcmdzOgogICAgcHJlZGljdF9rd2FyZ3MgPSBfZ2V0X3N1Yl9kaWN0X2J5X3ByZWZpeCgKICAgICAgICBzcmM9Y29udGV4dC5wYXJhbWV0ZXJzLCBwcmVmaXhfa2V5PUtXQXJnc1ByZWZpeGVzLlBSRURJQ1QKICAgICkKCiAgICAjIGxvYWRpbmcgdGhlIG1vZGVsLCBhbmQgZ2V0dGluZyB0aGUgbW9kZWwgaGFuZGxlcjoKICAgIG1vZGVsX2hhbmRsZXIgPSBBdXRvTUxSdW4ubG9hZF9tb2RlbChtb2RlbF9wYXRoPW1vZGVsLCBjb250ZXh0PWNvbnRleHQpCgogICAgIyBEcm9wcGluZyBsYWJlbCBjb2x1bW5zIGlmIG5lY2Vzc2FyeToKICAgIGlmIGxhYmVsX2NvbHVtbnMgYW5kIGFsbChsYWJlbCBpbiBkYXRhc2V0LmNvbHVtbnMgZm9yIGxhYmVsIGluIGxhYmVsX2NvbHVtbnMpOgogICAgICAgIGRhdGFzZXQgPSBkYXRhc2V0LmRyb3AobGFiZWxfY29sdW1ucywgYXhpcz0xKQoKICAgICMgUHJlZGljdGluZzoKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZiJtYWtpbmcgcHJlZGljdGlvbiBieSAne21vZGVsX2hhbmRsZXIubW9kZWxfbmFtZX0nIikKICAgIHlfcHJlZCA9IG1vZGVsX2hhbmRsZXIubW9kZWwucHJlZGljdChkYXRhc2V0LCAqKnByZWRpY3Rfa3dhcmdzKQoKICAgIGlmIG5vdCBsYWJlbF9jb2x1bW5zOgogICAgICAgIGlmIGxlbih5X3ByZWQuc2hhcGUpID09IDEgb3IgeV9wcmVkLnNoYXBlWzFdID09IDE6CiAgICAgICAgICAgIGxhYmVsX2NvbHVtbnMgPSBbInByZWRpY3RlZF9sYWJlbHMiXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxhYmVsX2NvbHVtbnMgPSBbZiJwcmVkaWN0ZWRfbGFiZWxfe2l9IiBmb3IgaSBpbiByYW5nZSh5X3ByZWQuc2hhcGVbMV0pXQogICAgZWxpZiBpc2luc3RhbmNlKGxhYmVsX2NvbHVtbnMsIHN0cik6CiAgICAgICAgbGFiZWxfY29sdW1ucyA9IFtsYWJlbF9jb2x1bW5zXQoKICAgIHByZWRfZGYgPSBwZC5jb25jYXQoW2RhdGFzZXQsIHBkLkRhdGFGcmFtZSh5X3ByZWQsIGNvbHVtbnM9bGFiZWxfY29sdW1ucyldLCBheGlzPTEpCiAgICBjb250ZXh0LmxvZ19kYXRhc2V0KCJwcmVkaWN0aW9uIiwgcHJlZF9kZikKCiAgICAjIERyaWZ0IEFuYWx5c2lzOgogICAgaWYgKAogICAgICAgIHBlcmZvcm1fZHJpZnRfYW5hbHlzaXMgaXMgTm9uZQogICAgICAgIGFuZCBtb2RlbF9oYW5kbGVyLl9tb2RlbF9hcnRpZmFjdC5mZWF0dXJlX3N0YXRzIGlzIG5vdCBOb25lCiAgICApOgogICAgICAgIHBlcmZvcm1fZHJpZnRfYW5hbHlzaXMgPSBUcnVlCiAgICBpZiBwZXJmb3JtX2RyaWZ0X2FuYWx5c2lzOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oIlBlcmZvcm1pbmcgZHJpZnQgYW5hbHlzaXMuIikKICAgICAgICAjIENoZWNrIGlmIHRoZSBtb2RlbCB3YXMgbG9nZ2VkIHdpdGggYSBzYW1wbGUgc2V0OgogICAgICAgIGlmIG1vZGVsX2hhbmRsZXIuX21vZGVsX2FydGlmYWN0LmZlYXR1cmVfc3RhdHMgaXMgTm9uZToKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgICJDYW5ub3QgcGVyZm9ybSBkcmlmdCBhbmFseXNpcyBhcyB0aGUgbW9kZWwgYXJ0aWZhY3Qgd2FzIG5vdCBsb2dnZWQgd2l0aCBhIHNhbXBsZSBzZXQuIgogICAgICAgICAgICApCiAgICAgICAgIyBQcm9kdWNlIHRoZSBhcnRpZmFjdDoKICAgICAgICAjIFRPRE86IFJlcGxhY2UgYHNhbXBsZV9zZXRfc3RhdGlzdGljc2AgdG8gYG1vZGVsX2hhbmRsZXIuX21vZGVsX2FydGlmYWN0LnNwZWMuZmVhdHVyZV9zdGF0c2Agd2hlbiBNTFJ1bidzCiAgICAgICAgIyAgICAgICB2ZXJzaW9uIGlzIHJlbGVhc2VkLgogICAgICAgIGRyaWZ0X2FuYWx5c2lzX2FydGlmYWN0cyA9IF9wZXJmb3JtX2RyaWZ0X2FuYWx5c2lzKAogICAgICAgICAgICBjb250ZXh0PWNvbnRleHQsCiAgICAgICAgICAgIHNhbXBsZV9zZXRfc3RhdGlzdGljcz1tb2RlbF9oYW5kbGVyLl9tb2RlbF9hcnRpZmFjdC5mZWF0dXJlX3N0YXRzLAogICAgICAgICAgICBpbnB1dHM9cHJlZF9kZiwKICAgICAgICAgICAgZHJpZnRfdGhyZXNob2xkPWRyaWZ0X3RocmVzaG9sZCwKICAgICAgICAgICAgcG9zc2libGVfZHJpZnRfdGhyZXNob2xkPXBvc3NpYmxlX2RyaWZ0X3RocmVzaG9sZCwKICAgICAgICApCiAgICAgICAgZm9yIGFydGlmYWN0IGluIGRyaWZ0X2FuYWx5c2lzX2FydGlmYWN0czoKICAgICAgICAgICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoYXJ0aWZhY3QpCg==
    commands: []
    code_origin: https://github.com/guy1992l/functions.git#6f66539b1a267dc42546961b08199aaae912a129:/Users/guyl/Projects/functions/auto_trainer/auto_trainer.py
    origin_filename: /Users/guyl/Projects/functions/auto_trainer/auto_trainer.py
  entry_points:
    train:
      name: train
      doc: Training the given model on the given dataset.
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context
        default: ''
      - name: dataset
        type: DataItem
        doc: The dataset to train the model on. Can be either a URI or a FeatureVector
        default: ''
      - name: drop_columns
        type: List[str]
        doc: str or a list of strings that represent the columns to drop
        default: null
      - name: model_class
        type: str
        doc: The class of the model, e.g. `sklearn.linear_model.LogisticRegression`
        default: null
      - name: model_name
        type: str
        doc: The model's name to use for storing the model artifact, default to 'model'
        default: model
      - name: tag
        type: str
        doc: The model's tag to log with
        default: ''
      - name: label_columns
        type: Optional[Union[str, List[str]]]
        doc: The target label(s) of the column(s) in the dataset. for Regression or
          Classification tasks
        default: null
      - name: sample_set
        type: DataItem
        doc: A sample set of inputs for the model for logging its stats along the
          model in favour of model monitoring. Can be either a URI or a FeatureVector
        default: null
      - name: test_set
        type: DataItem
        doc: The test set to train the model with
        default: null
      - name: train_test_split_size
        type: float
        doc: Should be between 0.0 and 1.0 and represent the proportion of the dataset
          to include in the test split. The size of the Training set is set to the
          complement of this value. Default = 0.2
        default: null
      - name: random_state
        type: int
        doc: Random state for `train_test_split`
        default: null
      outputs:
      - default: ''
      lineno: 102
    evaluate:
      name: evaluate
      doc: Evaluating a model. Artifacts generated by the MLHandler.
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: model
        type: str
        doc: The model Store path.
        default: ''
      - name: dataset
        type: DataItem
        doc: The dataset to evaluate the model on. Can be either a URI or a FeatureVector.
        default: ''
      - name: drop_columns
        type: List[str]
        doc: str or a list of strings that represent the columns to drop.
        default: null
      - name: label_columns
        type: Optional[Union[str, List[str]]]
        doc: The target label(s) of the column(s) in the dataset. for Regression or
          Classification tasks.
        default: null
      outputs:
      - default: ''
      lineno: 222
    predict:
      name: predict
      doc: 'Perform a prediction on a given dataset with the given model. Can perform
        drift analysis between the sample set

        statistics stored in the model to the current input data. The drift rule is
        the value per-feature mean of the TVD

        and Hellinger scores according to the thresholds configures here.'
      parameters:
      - name: context
        type: MLClientCtx
        doc: MLRun context.
        default: ''
      - name: model
        type: str
        doc: The model Store path.
        default: ''
      - name: dataset
        type: DataItem
        doc: The dataset to evaluate the model on. Can be either a URI, a FeatureVector
          or a sample in a shape of a list/dict.
        default: ''
      - name: drop_columns
        type: Union[str, List[str], int, List[int]]
        doc: str/int or a list of strings/ints that represent the column names/indices
          to drop. When the dataset is a list/dict this parameter should be represented
          by integers.
        default: null
      - name: label_columns
        type: Optional[Union[str, List[str]]]
        doc: The target label(s) of the column(s) in the dataset. for Regression or
          Classification tasks.
        default: null
      - name: perform_drift_analysis
        type: bool
        doc: Whether to perform drift analysis between the sample set of the model
          object to the dataset given. By default, None, which means it will perform
          drift analysis if the model has a sample set statistics. Perform drift analysis
          will produce a data drift table artifact.
        default: null
      - name: drift_threshold
        type: float
        doc: The threshold of which to mark drifts. Defaulted to 0.7.
        default: 0.7
      - name: possible_drift_threshold
        type: float
        doc: The threshold of which to mark possible drifts. Defaulted to 0.5.
        default: 0.5
      outputs:
      - default: ''
      lineno: 353
  description: Automatic train, evaluate and predict functions for the ML frameworks
    - Scikit-Learn, XGBoost and LightGBM.
  default_handler: train
  disable_auto_mount: false
  env: []
  priority_class_name: ''
  preemption_mode: prevent
  affinity: null
  tolerations: null
  security_context: {}
verbose: false
